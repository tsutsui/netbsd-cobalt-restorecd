Typical 'restorecd' script invocation:

1. fetch and extract newer restorecd-*.tar.gz

% ftp http://www.ceres.dti.ne.jp/~tsutsui/netbsd/restorecd-20071224.tar.gz
    (or from appropriate server)
% tar zxf restorecd-20071224.tar.gz
% cd restorecd

2. fetch NetBSD binaries and sources (for i386 and cobalt) into download dir
   (use appropriate mirrors)

with rsync:
% rsync -va --files-from=restorecd-fetch.lst \
    rsync://rsync.NetBSD.org/NetBSD/NetBSD-4.0/ download

with wget:
% (cd download ; \
  wget --base=ftp://ftp.NetBSD.org/pub/NetBSD/NetBSD-4.0/ \
  --no-host-directories --cut-dirs=3 --timestamping --force-directories \
  --input-file=../restorecd-fetch.lst)

  (NOTE adjuct --cut-dirs=N by which directory you'll get files)

3. fetch and extract e2fsprogs package binary

% (cd download ; \
    ftp ftp://ftp.NetBSD.org/pub/pkgsrc/packages/NetBSD/mipsel/3.0_2006Q4/sysutils/e2fsprogs-1.32.tgz)
% tar -C data/cobalt/usr/pkg -zxf download/e2fsprogs-1.32.tgz sbin/mke2fs

4. extract NetBSD sources

% tar zxf download/source/sets/gnusrc.tgz
% tar zxf download/source/sets/sharesrc.tgz
% tar zxf download/source/sets/src.tgz
% tar zxf download/source/sets/syssrc.tgz

4a. rebuild paneld binary (if you don't want to use a precompiled binary)

% (cd download; \
    ftp http://only.mawhrin.net/~cdi/netbsd/cobalt/paneld.tar.gz)
% (cd download; \
   ftp http://www.sigbus.net/paneld_banner_refresh.diff)
% (cd download; \
   ftp http://www.ceres.dti.ne.jp/~tsutsui/netbsd/paneld-20071105.diff)
% tar zxf download/paneld.tar.gz
% patch -d paneltools -p < download/paneld_banner_refresh.diff
% patch -p < download/paneld-20071105.diff
% (cd usr/src; \
   sh build.sh -m cobalt -u -U -T tooldir.cobalt -D destdir.cobalt \
   -V OBJMACHINE=1 tools)

   NOTE1: check your TOOLDIR in the build log here.
   NOTE2: make sure /etc/mk.conf not to override $TOOLDIR

% (cd usr/src; \
   tooldir.cobalt/bin/nbmake-cobalt do-distrib-dirs)
% (cd usr/src/destdir.cobalt; \
    tar zxpf ../../../download/cobalt/binary/sets/base.tgz)
% (cd usr/src/destdir.cobalt; \
    tar zxpf ../../../download/cobalt/binary/sets/comp.tgz)
% (cd paneltools/paneld && \
   ../../usr/src/tooldir.cobalt/bin/nbmake-cobalt OBJMACHINE=1 obj && \
   ../../usr/src/tooldir.cobalt/bin/nbmake-cobalt dependall)
% usr/src/tooldir.cobalt/bin/mipsel--netbsd-install -c -r -m 555 \
   paneltools/paneld/obj.cobalt/paneld data/cobalt/install/files/usr/sbin
% usr/src/tooldir.cobalt/bin/mipsel--netbsd-install -c -r -m 444 \
   paneltools/paneld/paneld.conf.5 \
   data/cobalt/install/files/usr/share/man/man5
% mkdir -p data/cobalt/install/files/usr/share/man/cat5
% usr/src/tooldir.cobalt/bin/mipsel--netbsd-install -c -r -m 444 \
   paneltools/paneld/obj.cobalt/paneld.conf.cat5 \
   data/cobalt/install/files/usr/share/man/cat5/paneld.conf.0
% usr/src/tooldir.cobalt/bin/mipsel--netbsd-install -c -r -m 444 \
   paneltools/paneld/paneld.8 \
   data/cobalt/install/files/usr/share/man/man8
% mkdir -p data/cobalt/install/files/usr/share/man/cat8
% usr/src/tooldir.cobalt/bin/mipsel--netbsd-install -c -r -m 444 \
   paneltools/paneld/obj.cobalt/paneld.cat8 \
   data/cobalt/install/files/usr/share/man/cat8/paneld.0

5. build tools to build i386 server's kernel and boot image

% (cd usr/src; sh build.sh -m i386 -u -U -T tooldir.i386 -V OBJMACHINE=1 tools)

   NOTE1: check your TOOLDIR in the build log here.
   NOTE2: make sure /etc/mk.conf not to override $TOOLDIR

6. execute restorecd script

% su
# sh restorecd server=`pwd`/download \
               client=`pwd`/download \
               source=`pwd`/usr/src  \
               tooldir=`pwd`/usr/src/tooldir.i386 -v

   NOTE1: use absolute paths to extracted restorecd dir (otherwise it fails)
   NOTE2: use your TOOLDIR for tooldir= arg if it isn't .../usr/src/tooldir.i386 
  Now you have an iso image in cd.tmp dir.
